(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(D){var c="calendar",v="zh-cn",R={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat",7:"Sun"},P={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"日"},y={year:"Year",month:"Month",day:"Day"},w={year:"年",month:"月",day:"日"},t=(v=="zh-cn"?P:R),d=(v=="zh-cn"?w:y);var V,i,l,C,n,z,h,m,q,g;var A,S,x,G,T,U,H,L,Y,j,M,e,k=false;D.fn.calendar=function(){var ab=arguments[0];if(F[ab]){ab=F[ab];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(ab)=="object"||!ab){ab=F.init}else{D.error("Method "+ab+" does not exist on jQuery.calendar");return this}}return ab.apply(this,arguments)};var E=D.fn.calendar.defaults={from:"0000-00-00",to:"9999-00-00",def:"",format:"yyyy-mm-dd",start:null,end:null,onSelect:D.noop,afterSelect:D.noop,onShow:D.noop,onHide:D.noop};var F={init:function(ab){return this.each(function(){var ad=D(this);var ac=ad.data(c);if(typeof(ac)=="undefined"){ac=D.extend({},D.fn.calendar.defaults,ab);ad.data(c,ac)}else{ac=D.extend({},ac,ab)}if(!V){V=a();D("body").append(V);V=D(".cal-panel");i=D("._header",V);l=D("._year",i);C=D("._month",i);n=D("._day_list",V);z=D("._month_list",V);h=D("._year_list",V);m=D("._left",V);q=D("._right",V);B()}b(ad,ac)})},destroy:function(ab){return D(this).each(function(){var ac=D(this);ac.removeData(c)})},val:function(ac){if(ac){s(ac);var ab=p(E.format);this.val(ab).attr("data-date",ab)}else{return this.attr("data-date")}}};function B(){l.on("click",function(){J("year")});C.on("click",function(){J("month")});h.on("click","._year",function(){var ac=D(this),ab=ac.text();if(!ac.hasClass("active")){return}T=ab;r();J("day")});z.on("click","._month",function(){var ac=D(this),ab=ac.text();if(!ac.hasClass("active")){return}U=parseInt(ab.substr(0,ab.length-1));r();J("day")});n.on("click","._day",function(){var ae=D(this),ad=ae.text(),af,ab,ac;if(!ae.hasClass("active")){return}G=parseInt(ad);S=T;x=U;ab=p(E.format);af=p(A.format);if(A.onSelect){ac=A.onSelect(af);if(ac===false){return}}g.val(af).attr("data-date",ab);if(Y=="start"){A.end.val("").attr("data-date","")}Q();r();if(A.afterSelect){A.afterSelect(af)}});m.on("click",O);q.on("click",aa);D(document).on("click",function(ab){if(k&&V){if(!g.is(ab.target)&&!D.contains(V[0],ab.target)&&!D(ab.target).hasClass("cal-icon")){Q()}}})}function aa(){if(q.hasClass("off")){return}if(L=="year"){j+=21;X()}else{if(L=="day"){if(U==12){U=1;T++}else{U++}f();u()}}}function O(){if(m.hasClass("off")){return}if(L=="year"){j-=21;X()}else{if(L=="day"){if(U==1){U=12;T--}else{U--}f();u()}}}function Q(){if(A.onHide){A.onHide()}V.hide();k=false}function I(ac){var af=ac.data(c),ad=ac.attr("data-date")||af.def,ab,ai,ah;g=ac;A=af;s(ad);ai=af.from;ah=af.to;Y="single";if(af.start){ab=af.start.attr("data-date");ai=ab?ab:af.from;Y="end"}else{if(af.end){Y="start"}}N(ai);Z(ah);if(M>e){throw"[calendar.error]from-date must small than to-date"}J("day");r();if(A.onShow){A.onShow()}var ag=ac.offset(),ae=ac.outerHeight();V.css({top:ag.top+ae+1+"px",left:ag.left+"px"}).show();k=true}function K(ad,ac,ae,ab){ae=""+ae;ab=""+ab;if(ae.length<2){ae="0"+ae}if(ab.length<2){ab="0"+ab}return ad.replace("yyyy",ac).replace("mm",ae).replace("dd",ab)}function p(ab){return K(ab,S,x,G)}function s(ac){var ab;if(ac==""){ab=W("n");j=T=ab.y;U=ab.m;H=ab.d;S=x=G=null}else{ab=W(ac);j=T=S=ab.y;U=x=ab.m;H=G=ab.d}}function N(ae){var ad,af,ab,ac;if(D.isArray(ae)){for(af=0,ab=ae.length;af<ab;af++){ad=W(ae[af]);if(af==0){ac=ad}else{if(ac.times<ad.times){ac=ad}}}}else{ac=W(ae)}M=K(E.format,ac.y,ac.m,ac.d)}function Z(ae){var ad,af,ab,ac;if(D.isArray(ae)){for(af=0,ab=ae.length;af<ab;af++){ad=W(ae[af]);if(af==0){ac=ad}else{if(ac.times>ad.times){ac=ad}}}}else{ac=W(ae)}e=K(E.format,ac.y,ac.m,ac.d)}function W(am){var ac=new Date(),an,aj=[],ag,ah,ap,ao,af,ab,ad=3600*1000*24,ai=ad*7,al=0,ae=0,ak=0;if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(am)){ao=am.split("-");al=parseInt(ao[0],10);ae=parseInt(ao[1],10);ak=parseInt(ao[2],10)}else{if(/^([\+\-]?((\d+[ymwd])|(\d+)|[ymwdnf]))+$/.test(am)){if(am.indexOf("f")>-1){ab=(new Date(M)).getTime()}else{ab=ac.getTime()}aj=am.match(/[\+\-]?((\d+[ymwd])|(\d+)|[ymwd])|[nf]/g);for(ag=0,ah=aj.length;ag<ah;ag++){ap=aj[ag];if(/^[\+\-]?\d+$/.test(ap)){ao=parseInt(ap);ab+=ao*ad}else{if(ap!="n"&&ap!="f"){af=ap.substr(ap.length-1);ao=ap.substring(0,ap.indexOf(af));ao=ao=="-"?"-1":ao;ao=ao=="+"?"1":ao;ao=parseInt(ao);if(af=="d"){ab+=ao*ad}else{if(af=="w"){ab+=ao*ai}else{if(af=="m"){an=new Date(ab);al=an.getFullYear();ae=an.getMonth();ak=an.getDate();if(ao>0){al+=Math.floor(ao/12)}else{al+=Math.ceil(ao/12)}ae+=ao%12;ab=(new Date(al,ae,ak)).getTime()}else{if(af=="y"){an=new Date(ab);al=an.getFullYear();ae=an.getMonth();ak=an.getDate();al+=ao;ab=(new Date(al,ae,ak)).getTime()}}}}}}}an=new Date(ab);al=an.getFullYear();ae=an.getMonth()+1;ak=an.getDate()}else{throw"[calendar.error]date express is error:"+am}}return{y:al,m:ae,d:ak,times:ab}}function J(ab){L=ab;n.hide();h.hide();z.hide();m.removeClass("off");q.removeClass("off");if(ab=="year"){h.show()}else{if(ab=="month"){z.show();m.addClass("off");q.addClass("off")}else{if(ab=="day"){n.show()}}}}function r(){u();X();o();f()}function u(){var ab;l.text(T);if(U<10){ab="0"+U}else{ab=U}C.text(ab)}function f(){var ab=(new Date(T,U,0)).getDate(),ae=(new Date(T,U-1,1)).getDay(),ad=ae+ab,ac=1;D("._day",n).each(function(ah,aj){var ag=D(aj),af=K(E.format,T,U,ac),ai="_day cal-day",ak="";if(ah>=ae&&ah<ad){ak=ac;if(af>=M&&af<e){ai+=" active";if(Y=="start"&&af==e){}else{if(Y=="end"&&af==M){ai+=" on start"}}if(ac==G&&S==T&&x==U){ai+=" on";if(Y=="start"){ai+=" start"}else{if(Y=="end"){ai+=" end"}}}}ac++}ag.text(ak).attr("class",ai)})}function o(){D(".on",z).removeClass("on");D("._month:eq("+(U-1)+")",z).addClass("on")}function X(){var ab=j-10;D(".on",h).removeClass("on");D("._year",h).each(function(ad,ae){var ac=D(ae);if(ab==T){ac.addClass("on")}ac.text(ab++)})}function a(){var af,ad,ab,ah,ac,ag,ae=[7,1,2,3,4,5,6];ag='<div class="cal-panel" style="display: none;"><div class="cal-left _left"></div><div class="cal-right _right"></div><div class="cal-header _header"><span class="_year cal-year"></span>'+d.year+'<span class="_month cal-month"></span>'+d.month+"</div>";ag+='<div class="cal-main _day_list">';ag+='<div class="cal-week _week">';for(af=0;af<7;af++){ag+='<span class="cal-weekday">'+t[ae[af]]+"</span>"}ag+="</div>";for(af=0,ab=6;af<ab;af++){ag+='<div class="cal-row">';for(ad=0,ah=7;ad<ah;ad++){ag+='<span class="cal-day _day"></span>'}ag+="</div>"}ag+="</div>";ag+='<div class="cal-main _year_list" style="display:none;">';for(af=0,ab=7;af<ab;af++){ag+='<div class="cal-row">';for(ad=0,ah=3;ad<ah;ad++){ag+='<span class="cal-cell active _year"></span>'}ag+="</div>"}ag+="</div>";ag+='<div class="cal-main _month_list" style="display:none;">';for(af=0,ab=4;af<ab;af++){ag+='<div class="cal-row">';for(ad=0,ah=3;ad<ah;ad++){ag+='<span class="cal-cell active _month">'+(3*af+ad+1)+d.month+"</span>"}ag+="</div>"}ag+="</div>";ag+="</div>";return D(ag)}function b(ad,ae){var ab=D('<span class="cal-icon"></span>'),ac,af;ab.click(function(){I(ad)});ad.focus(function(){I(ad)}).on("keyup",function(ag){if(ag.keyCode=="27"){Q()}});ad.after(ab);if(ae.def!=""){s(ae.def);ac=p(E.format);af=p(ae.format);ad.val(af).attr("data-date",ac)}}}));